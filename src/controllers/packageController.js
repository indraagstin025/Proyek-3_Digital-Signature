import asyncHandler from "../utils/asyncHandler.js";import CommonError from "../errors/CommonError.js"; // Kita perlukan untuk validasi/** * Membuat objek controller untuk fitur Paket Tanda Tangan (Signing Package). * * @param {import('../services/PackageService.js').PackageService} packageService - Instance dari PackageService. * @returns {object} Kumpulan fungsi handler untuk paket dokumen. */export const createPackageController = (packageService) => {    // Pastikan service-nya ada saat controller dibuat    if (!packageService) {        throw new Error("createPackageController: 'packageService' tidak disediakan.");    }    return {        /**         * @route   POST /api/packages         * @desc    Membuat paket (amplop) baru dari beberapa dokumen.         * @access  Private         */        createPackage: asyncHandler(async (req, res, next) => {            const userId = req.user?.id;            const { documentIds, title } = req.body; // Misal: ["id-doc-A", "id-doc-B"], "Kontrak Klien"            // Validasi input dasar            if (!documentIds || !Array.isArray(documentIds) || documentIds.length === 0) {                throw CommonError.BadRequest("Array 'documentIds' (berisi ID dokumen) wajib diisi.");            }            // Panggil "otak"-nya (service)            const newPackage = await packageService.createPackage(userId, title, documentIds);            return res.status(201).json({                status: "success",                message: "Paket berhasil dibuat.",                data: newPackage, // Kirim kembali data paket, terutama packageId            });        }),        /**         * @route   GET /api/packages/:packageId         * @desc    Mengambil detail paket, termasuk daftar dokumen di dalamnya.         * @access  Private         */        getPackageDetails: asyncHandler(async (req, res, next) => {            const userId = req.user?.id;            const { packageId } = req.params;            // Panggil "otak"-nya (service)            const packageDetails = await packageService.getPackageDetails(packageId, userId);            return res.status(200).json({                status: "success",                data: packageDetails,            });        }),        /**         * @route   POST /api/packages/:packageId/sign         * @desc    Menyelesaikan & menandatangani semua dokumen dalam paket (Wizard).         * @access  Private         */        signPackage: asyncHandler(async (req, res, next) => {            const userId = req.user?.id;            const { packageId } = req.params;            const { signatures } = req.body; // Ini adalah array besar berisi data TTD            // Validasi input dasar            if (!signatures || !Array.isArray(signatures) || signatures.length === 0) {                throw CommonError.BadRequest("Array 'signatures' (berisi data TTD) wajib diisi.");            }            // Panggil "otak"-nya (service)            const result = await packageService.signPackage(packageId, userId, signatures);            return res.status(200).json({                status: "success",                message: "Paket berhasil ditandatangani.",                data: result,            });        }),    };};