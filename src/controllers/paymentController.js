import asyncHandler from '../utils/asyncHandler.js';import CommonError from '../errors/CommonError.js';export const createPaymentController = (paymentService) => {    return {        /**         * @description Inisiasi pembayaran subscription.         * @route   POST /api/payments/subscribe         */        createSubscription: asyncHandler(async (req, res, next) => {            const userId = req.user?.id;            const { planType } = req.body;            if (!userId) throw CommonError.Unauthorized('Sesi berakhir, silakan login kembali.');            const transaction = await paymentService.createSubscription(userId, planType);            return res.status(201).json({                status: 'success',                message: 'Transaksi berhasil dibuat.',                data: {                    orderId: transaction.orderId,                    snapToken: transaction.snapToken,                    snapUrl: transaction.snapUrl,                    amount: transaction.amount                }            });        }),        /**         * @description Callback Webhook dari Midtrans.         * @route   POST /api/payments/webhook         */        handleWebhook: asyncHandler(async (req, res, next) => {            const notification = req.body;            await paymentService.handleWebhook(notification);            return res.status(200).json({                status: 'success',                message: 'Webhook processed successfully.'            });        }),        /**         * @description Mendapatkan detail transaksi berdasarkan Order ID.         * @route   GET /api/payments/status/:orderId         */        /**         * @description Membatalkan transaksi.         * @route POST /api/payments/cancel         */        cancelTransaction: asyncHandler(async (req, res, next) => {            const userId = req.user?.id;            const { orderId } = req.body;            if (!userId) throw CommonError.Unauthorized('Unauthorized');            if (!orderId) throw CommonError.BadRequest('Order ID is required');            const result = await paymentService.cancelTransaction(orderId, userId);            return res.status(200).json({                status: 'success',                message: result.message            });        }),        getTransactionStatus: asyncHandler(async (req, res, next) => {            const { orderId } = req.params;            const transaction = await paymentService.getTransactionByOrderId(orderId);            if (!transaction) throw CommonError.NotFound('Transaksi tidak ditemukan.');            return res.status(200).json({                status: 'success',                data: {                    orderId: transaction.orderId,                    status: transaction.status,                    amount: transaction.amount,                    planType: transaction.planType                }            });        })    };};